"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[4825],{4591:(e,a,o)=>{o.r(a),o.d(a,{assets:()=>t,contentTitle:()=>i,default:()=>m,frontMatter:()=>r,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"implementacao_tecnica/banco_de_dados","title":"Arquitetura de Dados","description":"Camada de Armazenamento","source":"@site/docs/implementacao_tecnica/banco_de_dados.md","sourceDirName":"implementacao_tecnica","slug":"/implementacao_tecnica/banco_de_dados","permalink":"/docs/implementacao_tecnica/banco_de_dados","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/implementacao_tecnica/banco_de_dados.md","tags":[],"version":"current","sidebarPosition":0,"frontMatter":{"sidebar_position":0,"title":"Arquitetura de Dados"},"sidebar":"tutorialSidebar","previous":{"title":"Implementa\xe7\xe3o T\xe9cnica","permalink":"/docs/category/implementa\xe7\xe3o-t\xe9cnica"},"next":{"title":"Planejamento Backend","permalink":"/docs/implementacao_tecnica/back_end"}}');var n=o(4848),d=o(8453);const r={sidebar_position:0,title:"Arquitetura de Dados"},i=void 0,t={},c=[{value:"Camada de Armazenamento",id:"camada-de-armazenamento",level:2},{value:"1. Banco de Dados Relacional (PostgreSQL)",id:"1-banco-de-dados-relacional-postgresql",level:2},{value:"2. Cache em Mem\xf3ria (Redis)",id:"2-cache-em-mem\xf3ria-redis",level:2},{value:"2.1. Casos de Uso Detalhados",id:"21-casos-de-uso-detalhados",level:3},{value:"2.2. Estrat\xe9gias de Implementa\xe7\xe3o",id:"22-estrat\xe9gias-de-implementa\xe7\xe3o",level:3},{value:"2.3. Considera\xe7\xf5es Operacionais",id:"23-considera\xe7\xf5es-operacionais",level:3},{value:"3. Logs Estruturados e Observabilidade",id:"3-logs-estruturados-e-observabilidade",level:2},{value:"3.1. Padr\xe3o de Estrutura do Log (Schema JSON)",id:"31-padr\xe3o-de-estrutura-do-log-schema-json",level:3},{value:"3.2. Arquitetura de Coleta e Armazenamento",id:"32-arquitetura-de-coleta-e-armazenamento",level:3},{value:"3.3. Estrat\xe9gia de Reten\xe7\xe3o de Dados",id:"33-estrat\xe9gia-de-reten\xe7\xe3o-de-dados",level:3},{value:"3.4. Seguran\xe7a e Mascaramento de Dados (LGPD)",id:"34-seguran\xe7a-e-mascaramento-de-dados-lgpd",level:3},{value:"3.5. Monitoramento e Alertas",id:"35-monitoramento-e-alertas",level:3},{value:"4. Conex\xe3o com os Requisitos Funcionais",id:"4-conex\xe3o-com-os-requisitos-funcionais",level:2}];function l(e){const a={blockquote:"blockquote",code:"code",em:"em",h2:"h2",h3:"h3",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,d.R)(),...e.components},{Details:o}=a;return o||function(e,a){throw new Error("Expected "+(a?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Details",!0),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(a.h2,{id:"camada-de-armazenamento",children:"Camada de Armazenamento"}),"\n",(0,n.jsx)(a.p,{children:"\u2003 A arquitetura de dados do Peerseed foi projetada sob o princ\xedpio de Persist\xeancia Poliglota, utilizando a tecnologia mais adequada para cada tipo de dado. A arquitetura garante a integridade transacional para opera\xe7\xf5es financeiras, alta performance para consultas frequentes e observabilidade completa do sistema. A estrutura suporta o ciclo de vida completo do cr\xe9dito P2P, desde o cadastro do usu\xe1rio at\xe9 a liquida\xe7\xe3o dos investimentos."}),"\n",(0,n.jsx)(a.h2,{id:"1-banco-de-dados-relacional-postgresql",children:"1. Banco de Dados Relacional (PostgreSQL)"}),"\n",(0,n.jsx)(a.p,{children:"\u2003  O cora\xe7\xe3o da persist\xeancia de dados \xe9 um banco de dados PostgreSQL, que serve como a fonte \xfanica da verdade para todos os dados estruturados e transacionais."}),"\n",(0,n.jsx)(a.pre,{children:(0,n.jsx)(a.code,{className:"language-SQL",children:"-- Tipos Enumerados (Enums)\n-- Utilizados para garantir a consist\xeancia e integridade dos dados em campos com valores pr\xe9-definidos.\nCREATE TYPE perfil_enum AS ENUM ('AGRICULTOR', 'INVESTIDOR', 'ADMIN');\nCREATE TYPE status_kyc_enum AS ENUM ('PENDENTE', 'VERIFICADO', 'REPROVADO', 'ANALISE_MANUAL');\nCREATE TYPE tipo_transacao_enum AS ENUM ('DEPOSITO_PIX', 'DEPOSITO_CRYPTO', 'SAQUE_PIX', 'SAQUE_CRYPTO', 'INVESTIMENTO_PRIMARIO', 'INVESTIMENTO_SECUNDARIO', 'RECEBIMENTO_PARCELA', 'VENDA_SECUNDARIO', 'TAXA_PLATAFORMA');\nCREATE TYPE status_transacao_enum AS ENUM ('PENDENTE', 'CONCLUIDA', 'FALHOU', 'CANCELADA');\nCREATE TYPE status_cpr_enum AS ENUM ('ANALISE', 'CAPTA\xc7\xc3O', 'FINANCIADO', 'EM_PAGAMENTO', 'QUITADO', 'INADIMPLENTE');\nCREATE TYPE risco_enum AS ENUM ('A', 'B', 'C', 'D', 'E');\nCREATE TYPE status_parcela_enum AS ENUM ('PENDENTE', 'PAGA', 'ATRASADA');\nCREATE TYPE status_investimento_enum AS ENUM ('ATIVO', 'VENDIDO', 'FINALIZADO');\nCREATE TYPE status_oferta_enum AS ENUM ('ABERTA', 'VENDIDA', 'CANCELADA');\nCREATE TYPE tipo_conta_enum AS ENUM ('CORRENTE', 'POUPANCA');\nCREATE TYPE status_verificacao_enum AS ENUM ('PENDENTE', 'VERIFICADA', 'INVALIDA');\n\n-- Usu\xe1rios\n-- Armazena as informa\xe7\xf5es de login e perfil de todos os participantes da plataforma.\nCREATE TABLE usuarios (\n    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n    nome_completo VARCHAR(255) NOT NULL,\n    email VARCHAR(255) UNIQUE NOT NULL,\n    senha_hash VARCHAR(255) NOT NULL,\n    cpf VARCHAR(11) UNIQUE NOT NULL,\n    celular VARCHAR(15) NOT NULL,\n    perfil perfil_enum NOT NULL,\n    status_kyc status_kyc_enum NOT NULL DEFAULT 'PENDENTE',\n    data_criacao TIMESTAMPTZ NOT NULL DEFAULT now(),\n    data_atualizacao TIMESTAMPTZ NOT NULL DEFAULT now()\n);\n\n-- Carteiras Digitais\n-- Representa a carteira digital de cada usu\xe1rio, onde os saldos em stablecoin (USDC) s\xe3o mantidos.\nCREATE TABLE carteiras (\n    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n    usuario_id UUID UNIQUE NOT NULL REFERENCES usuarios(id) ON DELETE CASCADE,\n    saldo_usdc DECIMAL(18, 8) NOT NULL DEFAULT 0.0,\n    saldo_bloqueado_usdc DECIMAL(18, 8) NOT NULL DEFAULT 0.0,\n    data_atualizacao TIMESTAMPTZ NOT NULL DEFAULT now()\n);\n\n-- CPRs (C\xe9dulas de Produtor Rural)\n-- Modela a oportunidade de investimento, contendo os termos do empr\xe9stimo solicitado pelo agricultor.\nCREATE TABLE cprs (\n    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n    agricultor_id UUID NOT NULL REFERENCES usuarios(id),\n    valor_solicitado DECIMAL(18, 2) NOT NULL,\n    taxa_juros_anual DECIMAL(5, 2) NOT NULL,\n    prazo_meses INT NOT NULL,\n    status status_cpr_enum NOT NULL DEFAULT 'ANALISE',\n    score_risco risco_enum NOT NULL,\n    total_cotas INT NOT NULL,\n    valor_por_cota_usdc DECIMAL(18, 8) NOT NULL, -- CORRE\xc7\xc3O: Adicionada v\xedrgula\n    data_emissao DATE,\n    data_vencimento_final DATE,\n    data_criacao TIMESTAMPTZ NOT NULL DEFAULT now()\n);\n\n-- Parcelas\n-- Detalha o cronograma de pagamentos de cada CPR.\nCREATE TABLE parcelas (\n    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n    cpr_id UUID NOT NULL REFERENCES cprs(id) ON DELETE CASCADE,\n    numero_parcela INT NOT NULL,\n    valor_principal DECIMAL(18, 2) NOT NULL,\n    valor_juros DECIMAL(18, 2) NOT NULL,\n    data_vencimento DATE NOT NULL,\n    status status_parcela_enum NOT NULL DEFAULT 'PENDENTE',\n    valor_multa_paga DECIMAL(18, 2) DEFAULT 0.0,\n    valor_juros_mora_pago DECIMAL(18, 2) DEFAULT 0.0,\n    data_pagamento TIMESTAMPTZ, -- CORRE\xc7\xc3O: Adicionada v\xedrgula\n    UNIQUE(cpr_id, numero_parcela) -- CORRE\xc7\xc3O: Adicionada constraint de unicidade\n);\n\n-- Investimentos\n-- Tabela de liga\xe7\xe3o que representa a participa\xe7\xe3o de um investidor em uma CPR.\nCREATE TABLE investimentos (\n    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n    investidor_id UUID NOT NULL REFERENCES usuarios(id),\n    cpr_id UUID NOT NULL REFERENCES cprs(id),\n    quantidade_cotas INT NOT NULL,\n    valor_cota_compra DECIMAL(18, 8) NOT NULL,\n    status status_investimento_enum NOT NULL DEFAULT 'ATIVO',\n    data_investimento TIMESTAMPTZ NOT NULL DEFAULT now()\n);\n\n-- Transa\xe7\xf5es\n-- Funciona como o livro-raz\xe3o (ledger), registrando toda e qualquer movimenta\xe7\xe3o nas carteiras.\nCREATE TABLE transacoes (\n    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n    carteira_id UUID NOT NULL REFERENCES carteiras(id),\n    valor DECIMAL(18, 8) NOT NULL,\n    tipo tipo_transacao_enum NOT NULL,\n    status status_transacao_enum NOT NULL DEFAULT 'PENDENTE',\n    referencia_externa_id VARCHAR(255),\n    descricao TEXT,\n    data_transacao TIMESTAMPTZ NOT NULL DEFAULT now(), -- CORRE\xc7\xc3O: Adicionada v\xedrgula\n    referencia_id UUID,\n    referencia_tipo VARCHAR(50)\n);\n\n-- Mercado Secund\xe1rio\n-- Modela as ofertas de venda de cotas de investimento no mercado secund\xe1rio.\nCREATE TABLE ofertas_secundario (\n    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n    investimento_id UUID NOT NULL REFERENCES investimentos(id), -- SUGEST\xc3O: Avaliar se a constraint UNIQUE aqui \xe9 desejada\n    quantidade_cotas_a_venda INT NOT NULL,\n    preco_por_cota_usdc DECIMAL(18, 8) NOT NULL,\n    status status_oferta_enum NOT NULL DEFAULT 'ABERTA',\n    data_criacao TIMESTAMPTZ NOT NULL DEFAULT now()\n);\n\n-- Contas Banc\xe1rias\n-- Armazena os dados banc\xe1rios dos usu\xe1rios para a opera\xe7\xe3o de saque (off-ramp) via Pix.\nCREATE TABLE contas_bancarias (\n    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n    usuario_id UUID NOT NULL REFERENCES usuarios(id) ON DELETE CASCADE,\n    banco VARCHAR(100) NOT NULL,\n    agencia VARCHAR(10) NOT NULL,\n    conta VARCHAR(20) NOT NULL,\n    tipo_conta tipo_conta_enum NOT NULL,\n    status status_verificacao_enum NOT NULL DEFAULT 'PENDENTE',\n    is_principal BOOLEAN NOT NULL DEFAULT false\n);\n\n-- Ledger de Eventos\n-- Garante a imutabilidade e a auditoria de opera\xe7\xf5es cr\xedticas atrav\xe9s de uma cadeia de hashes criptogr\xe1ficos.\nCREATE TABLE ledger_eventos (\n    id BIGSERIAL PRIMARY KEY,\n    timestamp TIMESTAMPTZ NOT NULL DEFAULT now(),\n    tipo_evento VARCHAR(100) NOT NULL,\n    ator_id UUID REFERENCES usuarios(id),\n    ator_tipo VARCHAR(50),\n    dados_evento JSONB NOT NULL, -- CORRE\xc7\xc3O: Removido campo duplicado\n    hash_anterior VARCHAR(64),\n    hash_atual VARCHAR(64) UNIQUE NOT NULL\n);\n\n"})}),"\n",(0,n.jsx)(a.h2,{id:"2-cache-em-mem\xf3ria-redis",children:"2. Cache em Mem\xf3ria (Redis)"}),"\n",(0,n.jsx)(a.p,{children:"\u2003 O Redis, um reposit\xf3rio de dados em mem\xf3ria de alta performance, ser\xe1 utilizado como uma camada de cache distribu\xeddo para armazenar dados vol\xe1teis e de acesso frequente, com o objetivo de acelerar a resposta da aplica\xe7\xe3o e reduzir a carga sobre o PostgreSQL."}),"\n",(0,n.jsx)(a.h3,{id:"21-casos-de-uso-detalhados",children:"2.1. Casos de Uso Detalhados"}),"\n",(0,n.jsxs)(a.p,{children:[(0,n.jsx)(a.strong,{children:"Gerenciamento de Sess\xf5es:"})," Armazenar tokens de sess\xe3o de usu\xe1rios logados ",(0,n.jsx)(a.code,{children:"(RF-SEC-001)"}),", permitindo uma valida\xe7\xe3o de sess\xe3o de baix\xedssima lat\xeancia pela API Gateway e pelos microsservi\xe7os."]}),"\n",(0,n.jsxs)(a.p,{children:[(0,n.jsx)(a.strong,{children:"Cache de Leituras (Cache-Aside):"})," Guardar c\xf3pias tempor\xe1rias de dados que s\xe3o lidos com frequ\xeancia, como a lista de ofertas do marketplace (para usu\xe1rios n\xe3o logados), detalhes de CPRs p\xfablicas, e dados de perfil de usu\xe1rios que n\xe3o mudam constantemente."]}),"\n",(0,n.jsxs)(a.p,{children:[(0,n.jsx)(a.strong,{children:"Rate Limiting (Limita\xe7\xe3o de Taxa):"})," Proteger endpoints sens\xedveis (como login ou envio de OTP) contra ataques de for\xe7a bruta, controlando o n\xfamero de requisi\xe7\xf5es por IP ou por usu\xe1rio em uma janela de tempo."]}),"\n",(0,n.jsxs)(a.p,{children:[(0,n.jsx)(a.strong,{children:"Filas de Baixa Lat\xeancia:"}),' Para tarefas ass\xedncronas simples que n\xe3o exigem a robustez de um message broker completo (ex: "enviar notifica\xe7\xe3o de boas-vindas ap\xf3s o cadastro").']}),"\n",(0,n.jsx)(a.h3,{id:"22-estrat\xe9gias-de-implementa\xe7\xe3o",children:"2.2. Estrat\xe9gias de Implementa\xe7\xe3o"}),"\n",(0,n.jsx)(a.p,{children:(0,n.jsx)(a.strong,{children:"Padr\xe3o de Cache (Cache-Aside / Lazy Loading):"})}),"\n",(0,n.jsx)(a.p,{children:"A aplica\xe7\xe3o seguir\xe1 o padr\xe3o Cache-Aside."}),"\n",(0,n.jsxs)(o,{children:[(0,n.jsx)("summary",{children:" Fluxo"}),(0,n.jsx)(a.p,{children:"1 - A aplica\xe7\xe3o tenta ler o dado do Redis."}),(0,n.jsxs)(a.p,{children:["2 - Se o dado existir ",(0,n.jsx)(a.strong,{children:"(cache hit)"}),", ele \xe9 retornado imediatamente."]}),(0,n.jsxs)(a.p,{children:["3 - Se o dado n\xe3o existir ",(0,n.jsx)(a.strong,{children:"(cache miss)"}),", a aplica\xe7\xe3o busca a informa\xe7\xe3o no PostgreSQL, a salva no Redis com um tempo de expira\xe7\xe3o (TTL), e ent\xe3o a retorna."]})]}),"\n",(0,n.jsx)(a.p,{children:(0,n.jsx)(a.strong,{children:"Estrat\xe9gia de Invalida\xe7\xe3o de Cache:"})}),"\n",(0,n.jsx)(a.p,{children:"Para garantir a consist\xeancia dos dados, duas estrat\xe9gias ser\xe3o usadas:"}),"\n",(0,n.jsxs)(a.p,{children:[(0,n.jsx)(a.strong,{children:"TTL (Time-To-Live):"})," Todos os dados em cache ter\xe3o um tempo de vida definido (ex: 5 minutos para a lista de ofertas do marketplace), garantindo que a informa\xe7\xe3o seja periodicamente atualizada."]}),"\n",(0,n.jsxs)(a.p,{children:[(0,n.jsx)(a.strong,{children:"Invalida\xe7\xe3o Ativa (Event-Driven):"}),' Para dados cr\xedticos, quando um registro for alterado no PostgreSQL (ex: o status de uma CPR muda para "FINANCIADO"), a aplica\xe7\xe3o emitir\xe1 um evento para explicitamente deletar a chave correspondente no Redis, for\xe7ando uma nova leitura do banco na pr\xf3xima requisi\xe7\xe3o.']}),"\n",(0,n.jsx)(a.h3,{id:"23-considera\xe7\xf5es-operacionais",children:"2.3. Considera\xe7\xf5es Operacionais"}),"\n",(0,n.jsxs)(a.p,{children:[(0,n.jsx)(a.strong,{children:"Estrutura de Chaves:"})," Ser\xe1 adotada uma conven\xe7\xe3o de nomenclatura de chaves para evitar colis\xf5es e facilitar a depura\xe7\xe3o. Ex: ",(0,n.jsx)(a.code,{children:"session:{userId}"}),", ",(0,n.jsx)(a.code,{children:"cpr:{cprId}:details"}),", ",(0,n.jsx)(a.code,{children:"marketplace:offers:page:{pageNumber}"}),"."]}),"\n",(0,n.jsxs)(a.p,{children:[(0,n.jsx)(a.strong,{children:"Pol\xedtica de Evic\xe7\xe3o:"})," Quando a mem\xf3ria do Redis estiver cheia, a pol\xedtica de evic\xe7\xe3o configurada ser\xe1 allkeys-lru (",(0,n.jsx)(a.code,{children:"Least Recently Used"}),"), que remove as chaves menos utilizadas recentemente."]}),"\n",(0,n.jsxs)(a.p,{children:[(0,n.jsx)(a.strong,{children:"Alta Disponibilidade:"})," Em produ\xe7\xe3o, o Redis n\xe3o ser\xe1 uma inst\xe2ncia \xfanica. Ser\xe1 configurado em modo de alta disponibilidade usando Redis Sentinel ou um servi\xe7o gerenciado de nuvem (como AWS ElastiCache ou Google Memorystore) com replica\xe7\xe3o e failover autom\xe1tico, em conformidade com o RNF de disponibilidade ",(0,n.jsx)(a.strong,{children:"(RNF-CF-01)"}),"."]}),"\n",(0,n.jsx)(a.h2,{id:"3-logs-estruturados-e-observabilidade",children:"3. Logs Estruturados e Observabilidade"}),"\n",(0,n.jsx)(a.p,{children:"A estrat\xe9gia de observabilidade da Peerseed se baseia na emiss\xe3o de logs estruturados em formato JSON para a sa\xedda padr\xe3o (stdout) de cada microsservi\xe7o. Esta abordagem desacopla os servi\xe7os da infraestrutura de logging, uma pr\xe1tica recomendada para garantir a manutenibilidade (RNF-M-03)."}),"\n",(0,n.jsx)(a.h3,{id:"31-padr\xe3o-de-estrutura-do-log-schema-json",children:"3.1. Padr\xe3o de Estrutura do Log (Schema JSON)"}),"\n",(0,n.jsx)(a.p,{children:"Para garantir que os logs sejam facilmente pesquis\xe1veis e analis\xe1veis, todo log gerado pela aplica\xe7\xe3o deve aderir a um schema comum:"}),"\n",(0,n.jsx)(a.pre,{children:(0,n.jsx)(a.code,{className:"language-JSON",children:'{\n  "timestamp": "2025-09-30T14:40:00.123Z",\n  "level": "INFO", // DEBUG, INFO, WARN, ERROR, CRITICAL\n  "service": "servico-de-analise-de-credito",\n  "correlation_id": "b1a4a233-1b2c-4b5c-8d6e-f7a8b9c0d1e2", // ID \xfanico que rastreia uma requisi\xe7\xe3o atrav\xe9s de m\xfaltiplos servi\xe7os\n  "user_id": "f4a5b6c7-d8e9-f0a1-b2c3-d4e5f6a7b8c9", // Opcional\n  "message": "An\xe1lise de cr\xe9dito para a solicita\xe7\xe3o xyz conclu\xedda com sucesso.",\n  "payload": { // Objeto com dados de contexto\n    "solicitacao_id": "xyz-123",\n    "score_gerado": 750,\n    "tempo_de_processamento_ms": 450\n  }\n}\n'})}),"\n",(0,n.jsx)(a.h3,{id:"32-arquitetura-de-coleta-e-armazenamento",children:"3.2. Arquitetura de Coleta e Armazenamento"}),"\n",(0,n.jsx)(a.p,{children:"\u2003 A aplica\xe7\xe3o em si \xe9 agn\xf3stica ao armazenamento. Para o MVP local, os logs s\xe3o exibidos no terminal e armazenos em um arquivo json. Em um ambiente de produ\xe7\xe3o, um agente coletor (como Fluentd ou Vector) captura os logs de stdout e os encaminha para um sistema de gerenciamento de logs centralizado (como AWS CloudWatch, Google Cloud Logging ou uma stack ELK), que implementar\xe1 as pol\xedticas de reten\xe7\xe3o e permitir\xe1 a cria\xe7\xe3o de dashboards e alertas."}),"\n",(0,n.jsxs)(a.p,{children:[(0,n.jsx)(a.strong,{children:"Coleta:"})," Em produ\xe7\xe3o, um agente coletor de logs (como Fluentd ou Vector) ser\xe1 executado em cada n\xf3/container. Ele ser\xe1 respons\xe1vel por capturar os logs stdout, adicionar metadados (ex: nome do container, n\xf3) e envi\xe1-los de forma ass\xedncrona para a camada de armazenamento."]}),"\n",(0,n.jsxs)(a.p,{children:[(0,n.jsx)(a.strong,{children:"Armazenamento:"})," Conforme nossa decis\xe3o anterior, a camada de armazenamento para logs ser\xe1 o pr\xf3prio sistema, para um MPV, com possibilidade de estens\xe3o para um servi\xe7o da AWS cmo o Dynamo. Isso centraliza o armazenamento e permite o uso de SQL para consultas e an\xe1lises."]}),"\n",(0,n.jsx)(a.h3,{id:"33-estrat\xe9gia-de-reten\xe7\xe3o-de-dados",children:"3.3. Estrat\xe9gia de Reten\xe7\xe3o de Dados"}),"\n",(0,n.jsx)(a.p,{children:"Logs podem consumir um grande volume de armazenamento."}),"\n",(0,n.jsx)(a.p,{children:"A seguinte pol\xedtica de reten\xe7\xe3o ser\xe1 aplicada:"}),"\n",(0,n.jsxs)(a.p,{children:[(0,n.jsx)(a.strong,{children:'30 dias "Hot":'})," Logs dos \xfaltimos 30 dias ser\xe3o mantidos localmente para consultas r\xe1pidas e depura\xe7\xe3o."]}),"\n",(0,n.jsxs)(a.p,{children:[(0,n.jsx)(a.strong,{children:'1 ano "Cold":'})," Ap\xf3s 30 dias, os logs ser\xe3o automaticamente exportados para um armazenamento de baixo custo (como AWS S3 Glacier ou Google Cloud Storage Archive) e mantidos por 1 ano para fins de auditoria e conformidade, sendo ent\xe3o permanentemente exclu\xeddos."]}),"\n",(0,n.jsx)(a.h3,{id:"34-seguran\xe7a-e-mascaramento-de-dados-lgpd",children:"3.4. Seguran\xe7a e Mascaramento de Dados (LGPD)"}),"\n",(0,n.jsxs)(a.p,{children:["Para estar em conformidade com a LGPD ",(0,n.jsx)(a.code,{children:"(RNF-S-04)"}),", a aplica\xe7\xe3o N\xc3O deve registrar dados sens\xedveis em texto claro."]}),"\n",(0,n.jsxs)(a.p,{children:[(0,n.jsx)(a.strong,{children:"A\xe7\xe3o:"})," As bibliotecas de logging da aplica\xe7\xe3o devem ser configuradas com filtros de mascaramento de dados para redigir automaticamente informa\xe7\xf5es como CPF, senhas, tokens de acesso e dados de cart\xe3o/conta banc\xe1ria antes de o log ser escrito."]}),"\n",(0,n.jsxs)(a.blockquote,{children:["\n",(0,n.jsxs)(a.p,{children:["Exemplo: ",(0,n.jsxs)(a.em,{children:['"cpf": "123.',(0,n.jsx)(a.em,{children:(0,n.jsx)(a.strong,{children:"."})}),'-00".']})]}),"\n"]}),"\n",(0,n.jsx)(a.h3,{id:"35-monitoramento-e-alertas",children:"3.5. Monitoramento e Alertas"}),"\n",(0,n.jsxs)(a.p,{children:["Os logs estruturados no TimescaleDB ser\xe3o a base para o monitoramento e alertas ",(0,n.jsx)(a.code,{children:"(RNF-M-03)"}),"."]}),"\n",(0,n.jsxs)(a.p,{children:[(0,n.jsx)(a.strong,{children:"A\xe7\xe3o:"})," Ferramentas como o Grafana ser\xe3o conectadas ao banco de dados para criar dashboards e configurar alertas baseados em consultas SQL. Por exemplo:"]}),"\n",(0,n.jsxs)(a.p,{children:[(0,n.jsx)(a.strong,{children:"ALERTAR SE:"})," O n\xfamero de logs com 'level' = 'ERROR' no 'service' = 'servico-de-pagamentos' for > 10 nos \xfaltimos 5 minutos."]}),"\n",(0,n.jsxs)(a.p,{children:[(0,n.jsx)(a.strong,{children:"CRIAR GR\xc1FICO:"})," Tempo de processamento m\xe9dio da an\xe1lise de cr\xe9dito (extra\xeddo do 'payload.tempo_de_processamento_ms')."]}),"\n",(0,n.jsx)(a.h2,{id:"4-conex\xe3o-com-os-requisitos-funcionais",children:"4. Conex\xe3o com os Requisitos Funcionais"}),"\n",(0,n.jsx)(a.p,{children:"Esta estrutura de armazenamento de dados foi projetada para atender diretamente aos requisitos funcionais e n\xe3o funcionais:"}),"\n",(0,n.jsxs)(a.table,{children:[(0,n.jsx)(a.thead,{children:(0,n.jsxs)(a.tr,{children:[(0,n.jsx)(a.th,{children:"Requisito"}),(0,n.jsx)(a.th,{children:"Atendido por"}),(0,n.jsx)(a.th,{children:"Observa\xe7\xe3o"})]})}),(0,n.jsxs)(a.tbody,{children:[(0,n.jsxs)(a.tr,{children:[(0,n.jsxs)(a.td,{children:[(0,n.jsx)(a.strong,{children:"RF-CAD-001 / RF-CAD-002"})," (Cadastro e autentica\xe7\xe3o de usu\xe1rios)"]}),(0,n.jsx)(a.td,{children:(0,n.jsx)(a.code,{children:"usuarios"})}),(0,n.jsx)(a.td,{children:"Campos de autentica\xe7\xe3o + status KYC"})]}),(0,n.jsxs)(a.tr,{children:[(0,n.jsxs)(a.td,{children:[(0,n.jsx)(a.strong,{children:"RF-USR-002"})," (Gest\xe3o de dados do usu\xe1rio)"]}),(0,n.jsxs)(a.td,{children:[(0,n.jsx)(a.code,{children:"usuarios"}),", ",(0,n.jsx)(a.code,{children:"contas_bancarias"})]}),(0,n.jsx)(a.td,{children:"Controle de perfis e dados banc\xe1rios"})]}),(0,n.jsxs)(a.tr,{children:[(0,n.jsxs)(a.td,{children:[(0,n.jsx)(a.strong,{children:"RF-AGR-001 / RF-AGR-002"})," (Solicita\xe7\xe3o de cr\xe9dito e an\xe1lise de risco)"]}),(0,n.jsx)(a.td,{children:(0,n.jsx)(a.code,{children:"cprs"})}),(0,n.jsx)(a.td,{children:"Campos de valor solicitado, status e score"})]}),(0,n.jsxs)(a.tr,{children:[(0,n.jsxs)(a.td,{children:[(0,n.jsx)(a.strong,{children:"RF-AGR-005"})," (Pagamento de parcelas)"]}),(0,n.jsx)(a.td,{children:(0,n.jsx)(a.code,{children:"parcelas"})}),(0,n.jsx)(a.td,{children:"Cronograma e status de pagamentos"})]}),(0,n.jsxs)(a.tr,{children:[(0,n.jsxs)(a.td,{children:[(0,n.jsx)(a.strong,{children:"RF-AGR-006"})," (Gest\xe3o de inadimpl\xeancia)"]}),(0,n.jsxs)(a.td,{children:[(0,n.jsx)(a.code,{children:"parcelas"})," + ",(0,n.jsx)(a.code,{children:"ledger_eventos"})]}),(0,n.jsx)(a.td,{children:"Registro imut\xe1vel de inadimpl\xeancias"})]}),(0,n.jsxs)(a.tr,{children:[(0,n.jsxs)(a.td,{children:[(0,n.jsx)(a.strong,{children:"RF-INV-001 / RF-INV-004"})," (On/Off-ramp)"]}),(0,n.jsxs)(a.td,{children:[(0,n.jsx)(a.code,{children:"carteiras"})," + ",(0,n.jsx)(a.code,{children:"transacoes"})]}),(0,n.jsx)(a.td,{children:"Movimenta\xe7\xe3o e saldo separado"})]}),(0,n.jsxs)(a.tr,{children:[(0,n.jsxs)(a.td,{children:[(0,n.jsx)(a.strong,{children:"RF-INV-002 / RF-INV-005"})," (Investimento e distribui\xe7\xe3o)"]}),(0,n.jsxs)(a.td,{children:[(0,n.jsx)(a.code,{children:"investimentos"})," + ",(0,n.jsx)(a.code,{children:"parcelas"})]}),(0,n.jsx)(a.td,{children:"Rela\xe7\xe3o CPR \u2194 Investidor"})]}),(0,n.jsxs)(a.tr,{children:[(0,n.jsxs)(a.td,{children:[(0,n.jsx)(a.strong,{children:"RF-INV-003"})," (Mercado secund\xe1rio)"]}),(0,n.jsx)(a.td,{children:(0,n.jsx)(a.code,{children:"ofertas_secundario"})}),(0,n.jsx)(a.td,{children:"Venda antecipada de cotas"})]}),(0,n.jsxs)(a.tr,{children:[(0,n.jsxs)(a.td,{children:[(0,n.jsx)(a.strong,{children:"RF-INV-006"})," (Extrato)"]}),(0,n.jsx)(a.td,{children:(0,n.jsx)(a.code,{children:"transacoes"})}),(0,n.jsx)(a.td,{children:"Ledger financeiro"})]}),(0,n.jsxs)(a.tr,{children:[(0,n.jsxs)(a.td,{children:[(0,n.jsx)(a.strong,{children:"RNF-S-02 / RNF-S-03"})," (Seguran\xe7a e transpar\xeancia)"]}),(0,n.jsx)(a.td,{children:(0,n.jsx)(a.code,{children:"ledger_eventos"})}),(0,n.jsx)(a.td,{children:"Cadeia de hashes para imutabilidade"})]}),(0,n.jsxs)(a.tr,{children:[(0,n.jsxs)(a.td,{children:[(0,n.jsx)(a.strong,{children:"RNF-ED-01"})," (Performance)"]}),(0,n.jsx)(a.td,{children:"Redis"}),(0,n.jsx)(a.td,{children:"Cache de dados cr\xedticos"})]}),(0,n.jsxs)(a.tr,{children:[(0,n.jsxs)(a.td,{children:[(0,n.jsx)(a.strong,{children:"RNF-M-03"})," (Observabilidade)"]}),(0,n.jsx)(a.td,{children:"Logs JSON stdout"}),(0,n.jsx)(a.td,{children:"Monitoramento estruturado"})]})]})]})]})}function m(e={}){const{wrapper:a}={...(0,d.R)(),...e.components};return a?(0,n.jsx)(a,{...e,children:(0,n.jsx)(l,{...e})}):l(e)}},8453:(e,a,o)=>{o.d(a,{R:()=>r,x:()=>i});var s=o(6540);const n={},d=s.createContext(n);function r(e){const a=s.useContext(d);return s.useMemo(function(){return"function"==typeof e?e(a):{...a,...e}},[a,e])}function i(e){let a;return a=e.disableParentContext?"function"==typeof e.components?e.components(n):e.components||n:r(e.components),s.createElement(d.Provider,{value:a},e.children)}}}]);